@model Attendence_Management_System.Models.Student.Reports.StudentCourseReportViewModel
@{
    ViewData["Title"] = "Course Report";
}

@await Html.PartialAsync("_AnalyticsHelpers")

<div class="d-flex justify-content-between align-items-start flex-wrap gap-2 mb-3">
    <div>
        <h2 class="mb-1">Course Report</h2>
        <div class="text-muted">@Model.CourseDisplay</div>
        <div class="text-muted small">Total: @Model.Total · Present: @Model.Present · Late: @Model.Late · Absent: @Model.Absent · %: @Model.Percentage</div>
    </div>
    <a class="btn btn-outline-light" href="/StudentDashboard/Index">Back</a>
</div>

<div class="row g-3 mb-3">
    <div class="col-12 col-md-4">
        <div class="ams-card p-3">
            <div class="ams-metric">
                <div>
                    <div class="label">Present</div>
                    <div class="value">@Model.Present</div>
                </div>
                <span class="ams-pill">@Pct(Model.Total, Model.Present)</span>
            </div>
            <div class="ams-chart mt-2"><div class="bar" style="width:@(PctInt(Model.Total, Model.Present))%"></div></div>
        </div>
    </div>
    <div class="col-12 col-md-4">
        <div class="ams-card p-3">
            <div class="ams-metric">
                <div>
                    <div class="label">Late</div>
                    <div class="value">@Model.Late</div>
                </div>
                <span class="ams-pill">@Pct(Model.Total, Model.Late)</span>
            </div>
            <div class="ams-chart mt-2"><div class="bar" style="width:@(PctInt(Model.Total, Model.Late))%"></div></div>
        </div>
    </div>
    <div class="col-12 col-md-4">
        <div class="ams-card p-3">
            <div class="ams-metric">
                <div>
                    <div class="label">Absent</div>
                    <div class="value">@Model.Absent</div>
                </div>
                <span class="ams-pill">@Pct(Model.Total, Model.Absent)</span>
            </div>
            <div class="ams-chart mt-2"><div class="bar" style="width:@(PctInt(Model.Total, Model.Absent))%"></div></div>
        </div>
    </div>
</div>

<div class="ams-card p-3 p-md-4">
    <div class="table-responsive">
        <table class="table table-dark table-hover align-middle mb-0" style="--bs-table-bg: transparent; --bs-table-border-color: rgba(255,255,255,.12);">
            <thead>
                <tr>
                    <th style="width: 160px">Date</th>
                    <th>Teacher</th>
                    <th style="width: 160px">Type</th>
                    <th style="width: 160px">Status</th>
                </tr>
            </thead>
            <tbody>
            @if (Model.Rows.Count == 0)
            {
                <tr>
                    <td colspan="4" class="text-muted">No attendance records yet.</td>
                </tr>
            }
            else
            {
                foreach (var r in Model.Rows)
                {
                    <tr>
                        <td>@r.Date.ToString("yyyy-MM-dd")</td>
                        <td>@r.TeacherName</td>
                        <td>@(r.IsMakeUpLecture ? "Make-up" : "Scheduled")</td>
                        <td>
                            @if (r.Status == Attendence_Management_System.Data.AttendanceStatus.Present)
                            {
                                <span class="badge text-bg-success">Present</span>
                            }
                            else if (r.Status == Attendence_Management_System.Data.AttendanceStatus.Late)
                            {
                                <span class="badge text-bg-warning">Late</span>
                            }
                            else
                            {
                                <span class="badge text-bg-danger">Absent</span>
                            }
                        </td>
                    </tr>
                }
            }
            </tbody>
        </table>
    </div>

    <div class="text-muted small mt-3">Note: multiple teachers may mark attendance; you will see all teacher-marked entries.</div>
</div>
